---
title: Vue SSR å®˜æ–¹æ–‡æ¡£å®è·µÂ·äºŒï¼šå‰åç«¯æ··åˆä»ç²—æš´åˆ°æ­£å¸¸
date: 2017-06-22 13:12:43
tags:
---
> å†™å®Œä¸Šä¸€ç¯‡{% post_link vue-ssr-step-1 %}ä¹‹åï¼Œæ€è·¯å˜æ¸…äº†ä¸å°‘ã€‚ä»Šå¤©ä¸­åˆå†è¯»å®Œ [Build Configuration](http://ssr.vuejs.org/en/build-config.html) ç« èŠ‚ï¼Œæ¯”è¾ƒè½»æ¾çš„è¿è¡Œäº†ç¤ºä¾‹ä»£ç ã€‚  
> ä¸è¿‡å¤šåŠ äº†å‡ ä¸ªwebpacké€‰é¡¹ï¼Œæ··åˆèµ·æ¥å˜å¾—æ›´åŠ ç®€å•ã€‚å¤§ç¥é“ºè·¯é“ºå¾—å°±æ˜¯å¥½ã€‚ã€‚  

**å®è·µTarget:** [Build Configuration](http://ssr.vuejs.org/en/build-config.html)

### Serverç«¯ å¯ç”¨vue-ssr plugin  

| å¯ç”¨å‰| - | å¯ç”¨å |
| ------| ------ | ------ |
| ![server1.png](https://ooo.0o0.ooo/2017/06/22/594b584a3e1e8.png) | - | ![server2.png](https://ooo.0o0.ooo/2017/06/22/594b5849e0aad.png) |
| å¯ç”¨å‰ï¼Œå¼‚æ­¥åŠ è½½çš„ç»„ä»¶ï¼Œè¢«åˆ†å‰²å¼€æ¥| - | å¯ç”¨åServerç«¯æ‰“åŒ…ä¸å†è¿›è¡Œåˆ†å‰²ï¼Œåªè¾“å‡ºä¸€ä¸ªæ–‡ä»¶ |    

å®¢æˆ·ç«¯æ‰“åŒ…ï¼Œå¯¹æ–‡ä»¶åˆ†å‰²å®ç°æ‡’åŠ è½½ï¼Œå¯ä»¥ä»¤æµè§ˆå™¨åªåŠ è½½éœ€è¦çš„å†…å®¹ï¼Œæœ‰ä½“éªŒæå‡ã€‚  
ä½†æœåŠ¡ç«¯æ‰“åŒ…çš„æ–‡ä»¶ï¼Œç»™åç«¯ç¨‹åºä½¿ç”¨ï¼Œä¸é€šè¿‡ç½‘ç»œè¯·æ±‚è·å–ï¼Œåˆ†å‰²ä»£ç æ„ä¹‰ä¸å¤§ç”šè‡³é™ä½æ€§èƒ½ï¼Œæ‰€ä»¥æ‰“åŒ…æˆä¸€ä¸ªæ–‡ä»¶æ›´å¥½ã€‚

### Clientç«¯ å¯ç”¨ manifestï¼Œå¯ç”¨vue-ssr plugin

**ç›¸å…³é…ç½®æ–‡ä»¶**  
```javascript
plugins: [
    new webpack.optimize.CommonsChunkPlugin({
      name: 'mainfest',
      minChunks: Infinity
    }),
    new VueSSRClientPlugin()
  ]
```
**å¯¹æ¯”** 

| å¯ç”¨å‰| - | å¯ç”¨å |
| ------| ------ | ------ |
| ![client1.png](https://ooo.0o0.ooo/2017/06/22/594b5c09924cb.png) | - | ![client2.png](https://ooo.0o0.ooo/2017/06/22/594b5c0a7353b.png) |
| å¯ç”¨å‰ï¼Œå‰åç«¯è¾“å‡ºæ–‡ä»¶åç§°ä¸€è‡´ï¼Œä¼šé€ æˆè¦†ç›–| - | å¯ç”¨åï¼Œç”Ÿæˆ manifest, å¯ä»¥ä½¿ç”¨vue-ssræ’ä»¶è‡ªåŠ¨æ³¨å…¥js |  

å¯ç”¨å‰ï¼Œåœ¨é¡µé¢æ³¨å…¥JSï¼Œéœ€è¦æ‰‹åŠ¨åœ¨ index.template.html ä½œå¦‚ä¸‹æ·»åŠ  
```html
<body>
  <!--vue-ssr-outlet-->
  <script src="./dist/bundle.js"></script> <!-- æ‰‹åŠ¨æ·»åŠ ï¼Œå¯ç”¨åä¸éœ€è¦æ·»åŠ è¿™ä¸€è¡Œ-->
</body>
```

## ä¿®æ”¹server.js  

**1. æ›´æ”¹renderer**  

| å‰| - | å |
| ------| ------ | ------ |
| ![render1.png](https://ooo.0o0.ooo/2017/06/22/594b6c340b19b.png) | - | ![render2.png](https://ooo.0o0.ooo/2017/06/22/594b6c375263e.png) |
| createRender | - | æ›´æ”¹ä¸º createBundleRendererï¼Œå¹¶ç”±æ‰“åŒ…ç”Ÿæˆçš„å•æ–‡ä»¶åˆ›å»º |  

**2. æ›´æ”¹expressé…ç½®** 

| å‰| - | å |
| ------| ------ | ------ |
| ![app1.png](https://ooo.0o0.ooo/2017/06/22/594b6e36a7ecf.png) | - | ![app2.png](https://ooo.0o0.ooo/2017/06/22/594b6e3622523.png) |
| ä»æ‰“åŒ…å¾—åˆ°çš„æ–‡ä»¶å¼•å…¥createApp | - | renderä¸­è‡ªåŠ¨åŒ…å«appå†…å®¹ï¼Œä¸éœ€è¦å¼•å…¥ã€‚åªéœ€è¦ä¼ å…¥context |  

## æ›´æ”¹è·¯å¾„ï¼Œæ’¤é”€ç²—æš´  

**æ·»åŠ webpackå…³é”®é…ç½®**
```javascript
output:{
  publicPath: '/dist/',
  ...
}
```
è‡ªåŠ¨æ³¨å…¥çš„script.src éƒ½æŒ‡å‘ dist ç›®å½•ä¸‹æ–‡ä»¶ï¼Œserver.jsä¸­å¼ºåˆ¶redirectçš„ä¸­é—´ä»¶é€»è¾‘å¯ä»¥åˆ é™¤äº†ã€‚


## ENDğŸ”š   

å›é¡¾ä¸€ä¸‹ï¼Œå®ŒæˆæœåŠ¡ç«¯æ¸²æŸ“çš„é…ç½®ï¼Œå¤§éƒ¨åˆ†é webpackçš„ç†Ÿç»ƒåº¦ã€‚  